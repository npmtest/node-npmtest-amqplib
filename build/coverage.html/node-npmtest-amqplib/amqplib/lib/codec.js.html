<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-amqplib/amqplib/lib/codec.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-amqplib">npmtest-amqplib (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-amqplib/amqplib/lib/codec.js</span></h1>
    <h2>
        
        Statements: <span class="metric">6.32% <small>(11 / 174)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 61)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 8)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">7.8% <small>(11 / 141)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-amqplib/amqplib/lib/</a> &#187; codec.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// 
//
//
&nbsp;
/*
&nbsp;
The AMQP 0-9-1 is a mess when it comes to the types that can be
encoded on the wire.
&nbsp;
There are four encoding schemes, and three overlapping sets of types:
frames, methods, (field-)tables, and properties.
&nbsp;
Each *frame type* has a set layout in which values of given types are
concatenated along with sections of "raw binary" data.
&nbsp;
In frames there are `shortstr`s, that is length-prefixed strings of
UTF8 chars, 8 bit unsigned integers (called `octet`), unsigned 16 bit
integers (called `short` or `short-uint`), unsigned 32 bit integers
(called `long` or `long-uint`), unsigned 64 bit integers (called
`longlong` or `longlong-uint`), and flags (called `bit`).
&nbsp;
Methods are encoded as a frame giving a method ID and a sequence of
arguments of known types. The encoded method argument values are
concatenated (with some fun complications around "packing" consecutive
bit values into bytes).
&nbsp;
Along with the types given in frames, method arguments may be long
byte strings (`longstr`, not required to be UTF8) or 64 bit unsigned
integers to be interpreted as timestamps (yeah I don't know why
either), or arbitrary sets of key-value pairs (called `field-table`).
&nbsp;
Inside a field table the keys are `shortstr` and the values are
prefixed with a byte tag giving the type. The types are any of the
above except for bits (which are replaced by byte-wide `bool`), along
with a NULL value `void`, a special fixed-precision number encoding
(`decimal`), IEEE754 `float`s and `double`s, signed integers,
`field-array` (a sequence of tagged values), and nested field-tables.
&nbsp;
RabbitMQ and QPid use a subset of the field-table types, and different
value tags, established before the AMQP 0-9-1 specification was
published. So far as I know, no-one uses the types and tags as
published. http://www.rabbitmq.com/amqp-0-9-1-errata.html gives the
list of field-table types.
&nbsp;
Lastly, there are (sets of) properties, only one of which is given in
AMQP 0-9-1: `BasicProperties`. These are almost the same as methods,
except that they appear in content header frames, which include a
content size, and they carry a set of flags indicating which
properties are present. This scheme can save ones of bytes per message
(messages which take a minimum of three frames each to send).
&nbsp;
*/
&nbsp;
'use strict';
&nbsp;
var ints = require('buffer-more-ints');
&nbsp;
// JavaScript uses only doubles so what I'm testing for is whether
// it's *better* to encode a number as a float or double. This really
// just amounts to testing whether there's a fractional part to the
// number, except that see below. NB I don't use bitwise operations to
// do this 'efficiently' -- it would mask the number to 32 bits.
//
// At 2^50, doubles don't have sufficient precision to distinguish
// between floating point and integer numbers (`Math.pow(2, 50) + 0.1
// === Math.pow(2, 50)` (and, above 2^53, doubles cannot represent all
// integers (`Math.pow(2, 53) + 1 === Math.pow(2, 53)`)). Hence
// anything with a magnitude at or above 2^50 may as well be encoded
// as a 64-bit integer. Except that only signed integers are supported
// by RabbitMQ, so anything above 2^63 - 1 must be a double.
<span class="fstat-no" title="function not covered" >function isFloatingPoint(n) {</span>
<span class="cstat-no" title="statement not covered" >    return n &gt;= 0x8000000000000000 ||</span>
        (Math.abs(n) &lt; 0x4000000000000
         &amp;&amp; Math.floor(n) !== n);
}
&nbsp;
<span class="fstat-no" title="function not covered" >function encodeTable(buffer, val, offset) {</span>
<span class="cstat-no" title="statement not covered" >    var start = offset;</span>
<span class="cstat-no" title="statement not covered" >    offset += 4; </span>// leave room for the table length
<span class="cstat-no" title="statement not covered" >    for (var key in val) {</span>
<span class="cstat-no" title="statement not covered" >        if (val[key] !== undefined) {</span>
<span class="cstat-no" title="statement not covered" >          var len = Buffer.byteLength(key);</span>
<span class="cstat-no" title="statement not covered" >          buffer.writeUInt8(len, offset); <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
<span class="cstat-no" title="statement not covered" >          buffer.write(key, offset, 'utf8'); <span class="cstat-no" title="statement not covered" ></span>offset += len;</span>
<span class="cstat-no" title="statement not covered" >          offset += encodeFieldValue(buffer, val[key], offset);</span>
        }
    }
<span class="cstat-no" title="statement not covered" >    var size = offset - start;</span>
<span class="cstat-no" title="statement not covered" >    buffer.writeUInt32BE(size - 4, start);</span>
<span class="cstat-no" title="statement not covered" >    return size;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function encodeArray(buffer, val, offset) {</span>
<span class="cstat-no" title="statement not covered" >    var start = offset;</span>
<span class="cstat-no" title="statement not covered" >    offset += 4;</span>
<span class="cstat-no" title="statement not covered" >    for (var i=0, num=val.length; i &lt; num; i++) {</span>
<span class="cstat-no" title="statement not covered" >        offset += encodeFieldValue(buffer, val[i], offset);</span>
    }
<span class="cstat-no" title="statement not covered" >    var size = offset - start;</span>
<span class="cstat-no" title="statement not covered" >    buffer.writeUInt32BE(size - 4, start);</span>
<span class="cstat-no" title="statement not covered" >    return size;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function encodeFieldValue(buffer, value, offset) {</span>
<span class="cstat-no" title="statement not covered" >    var start = offset;</span>
<span class="cstat-no" title="statement not covered" >    var type = typeof value, val = value;</span>
    // A trapdoor for specifying a type, e.g., timestamp
<span class="cstat-no" title="statement not covered" >    if (value &amp;&amp; type === 'object' &amp;&amp; value.hasOwnProperty('!')) {</span>
<span class="cstat-no" title="statement not covered" >        val = value.value;</span>
<span class="cstat-no" title="statement not covered" >        type = value['!'];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function tag(t) {</span> <span class="cstat-no" title="statement not covered" >buffer.write(t, offset); <span class="cstat-no" title="statement not covered" ></span>offset++; </span>}
&nbsp;
<span class="cstat-no" title="statement not covered" >    switch (type) {</span>
    case 'string': // no shortstr in field tables
<span class="cstat-no" title="statement not covered" >        var len = Buffer.byteLength(val, 'utf8');</span>
<span class="cstat-no" title="statement not covered" >        tag('S');</span>
<span class="cstat-no" title="statement not covered" >        buffer.writeUInt32BE(len, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >        buffer.write(val, offset, 'utf8'); <span class="cstat-no" title="statement not covered" ></span>offset += len;</span>
<span class="cstat-no" title="statement not covered" >        break;</span>
    case 'object':
<span class="cstat-no" title="statement not covered" >        if (val === null) {</span>
<span class="cstat-no" title="statement not covered" >            tag('V');</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (Array.isArray(val)) {</span>
<span class="cstat-no" title="statement not covered" >            tag('A');</span>
<span class="cstat-no" title="statement not covered" >            offset += encodeArray(buffer, val, offset);</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (Buffer.isBuffer(val)) {</span>
<span class="cstat-no" title="statement not covered" >            tag('x');</span>
<span class="cstat-no" title="statement not covered" >            buffer.writeUInt32BE(val.length, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >            val.copy(buffer, offset); <span class="cstat-no" title="statement not covered" ></span>offset += val.length;</span>
        }
        else {
<span class="cstat-no" title="statement not covered" >            tag('F');</span>
<span class="cstat-no" title="statement not covered" >            offset += encodeTable(buffer, val, offset);</span>
        }
<span class="cstat-no" title="statement not covered" >        break;</span>
    case 'boolean':
<span class="cstat-no" title="statement not covered" >        tag('t');</span>
<span class="cstat-no" title="statement not covered" >        buffer.writeUInt8((val) ? 1 : 0, offset); <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
<span class="cstat-no" title="statement not covered" >        break;</span>
    case 'number':
        // Making assumptions about the kind of number (floating point
        // v integer, signed, unsigned, size) desired is dangerous in
        // general; however, in practice RabbitMQ uses only
        // longstrings and unsigned integers in its arguments, and
        // other clients generally conflate number types anyway. So
        // the only distinction we care about is floating point vs
        // integers, preferring integers since those can be promoted
        // if necessary. If floating point is required, we may as well
        // use double precision.
<span class="cstat-no" title="statement not covered" >        if (isFloatingPoint(val)) {</span>
<span class="cstat-no" title="statement not covered" >            tag('d');</span>
<span class="cstat-no" title="statement not covered" >            buffer.writeDoubleBE(val, offset);</span>
<span class="cstat-no" title="statement not covered" >            offset += 8;</span>
        }
        else { // only signed values are used in tables by
               // RabbitMQ. It *used* to (&lt; v3.3.0) treat the byte 'b'
               // type as unsigned, but most clients (and the spec)
               // think it's signed, and now RabbitMQ does too.
<span class="cstat-no" title="statement not covered" >            if (val &lt; 128 &amp;&amp; val &gt;= -128) {</span>
<span class="cstat-no" title="statement not covered" >                tag('b');</span>
<span class="cstat-no" title="statement not covered" >                buffer.writeInt8(val, offset); <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
            }
            else <span class="cstat-no" title="statement not covered" >if (val &gt;= -0x8000 &amp;&amp; val &lt; 0x8000) { //  short</span>
<span class="cstat-no" title="statement not covered" >                tag('s');</span>
<span class="cstat-no" title="statement not covered" >                buffer.writeInt16BE(val, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 2;</span>
            }
            else <span class="cstat-no" title="statement not covered" >if (val &gt;= -0x80000000 &amp;&amp; val &lt; 0x80000000) { // int</span>
<span class="cstat-no" title="statement not covered" >                tag('I');</span>
<span class="cstat-no" title="statement not covered" >                buffer.writeInt32BE(val, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
            }
            else { // long
<span class="cstat-no" title="statement not covered" >                tag('l');</span>
<span class="cstat-no" title="statement not covered" >                ints.writeInt64BE(buffer, val, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 8;</span>
            }
        }
<span class="cstat-no" title="statement not covered" >        break;</span>
    // Now for exotic types, those can only be denoted by using
    // `{'!': type, value: val}
    case 'timestamp':
<span class="cstat-no" title="statement not covered" >        tag('T');</span>
<span class="cstat-no" title="statement not covered" >        ints.writeUInt64BE(buffer, val, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 8;</span>
<span class="cstat-no" title="statement not covered" >        break;</span>
    case 'float':
<span class="cstat-no" title="statement not covered" >        tag('f');</span>
<span class="cstat-no" title="statement not covered" >        buffer.writeFloatBE(val, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >        break;</span>
    case 'decimal':
<span class="cstat-no" title="statement not covered" >        tag('D');</span>
<span class="cstat-no" title="statement not covered" >        if (val.hasOwnProperty('places') &amp;&amp; val.hasOwnProperty('digits')</span>
            &amp;&amp; val.places &gt;= 0 &amp;&amp; val.places &lt; 256) {
<span class="cstat-no" title="statement not covered" >            buffer[offset] = val.places; <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
<span class="cstat-no" title="statement not covered" >            buffer.writeUInt32BE(val.digits, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
        }
        else <span class="cstat-no" title="statement not covered" >throw new TypeError(</span>
            "Decimal value must be {'places': 0..255, 'digits': uint32}, " +
                "got " + JSON.stringify(val));
<span class="cstat-no" title="statement not covered" >        break;</span>
    default:
<span class="cstat-no" title="statement not covered" >        throw new TypeError('Unknown type to encode: ' + type);</span>
    }
<span class="cstat-no" title="statement not covered" >    return offset - start;</span>
}
&nbsp;
// Assume we're given a slice of the buffer that contains just the
// fields.
<span class="fstat-no" title="function not covered" >function decodeFields(slice) {</span>
<span class="cstat-no" title="statement not covered" >    var fields = {}, offset = 0, size = slice.length;</span>
<span class="cstat-no" title="statement not covered" >    var len, key, val;</span>
&nbsp;
<span class="fstat-no" title="function not covered" >    function decodeFieldValue() {</span>
<span class="cstat-no" title="statement not covered" >        var tag = String.fromCharCode(slice[offset]); <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
<span class="cstat-no" title="statement not covered" >        switch (tag) {</span>
        case 'b':
<span class="cstat-no" title="statement not covered" >            val = slice.readInt8(offset); <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'S':
<span class="cstat-no" title="statement not covered" >            len = slice.readUInt32BE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >            val = slice.toString('utf8', offset, offset + len);</span>
<span class="cstat-no" title="statement not covered" >            offset += len;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'I':
<span class="cstat-no" title="statement not covered" >            val = slice.readInt32BE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'D': // only positive decimals, apparently.
<span class="cstat-no" title="statement not covered" >            var places = slice[offset]; <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
<span class="cstat-no" title="statement not covered" >            var digits = slice.readUInt32BE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >            val = {'!': 'decimal', value: {places: places, digits: digits}};</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'T':
<span class="cstat-no" title="statement not covered" >            val = ints.readUInt64BE(slice, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 8;</span>
<span class="cstat-no" title="statement not covered" >            val = {'!': 'timestamp', value: val};</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'F':
<span class="cstat-no" title="statement not covered" >            len = slice.readUInt32BE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >            val = decodeFields(slice.slice(offset, offset + len));</span>
<span class="cstat-no" title="statement not covered" >            offset += len;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'A':
<span class="cstat-no" title="statement not covered" >            len = slice.readUInt32BE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >            decodeArray(offset + len);</span>
            // NB decodeArray will itself update offset and val
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'd':
<span class="cstat-no" title="statement not covered" >            val = slice.readDoubleBE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 8;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'f':
<span class="cstat-no" title="statement not covered" >            val = slice.readFloatBE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'l':
<span class="cstat-no" title="statement not covered" >            val = ints.readInt64BE(slice, offset); <span class="cstat-no" title="statement not covered" ></span>offset += 8;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 's':
<span class="cstat-no" title="statement not covered" >            val = slice.readInt16BE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 2;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 't':
<span class="cstat-no" title="statement not covered" >            val = slice[offset] != 0; <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'V':
<span class="cstat-no" title="statement not covered" >            val = null;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        case 'x':
<span class="cstat-no" title="statement not covered" >            len = slice.readUInt32BE(offset); <span class="cstat-no" title="statement not covered" ></span>offset += 4;</span>
<span class="cstat-no" title="statement not covered" >            val = slice.slice(offset, offset + len);</span>
<span class="cstat-no" title="statement not covered" >            offset += len;</span>
<span class="cstat-no" title="statement not covered" >            break;</span>
        default:
<span class="cstat-no" title="statement not covered" >            throw new TypeError('Unexpected type tag "' + tag +'"');</span>
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function decodeArray(until) {</span>
<span class="cstat-no" title="statement not covered" >        var vals = [];</span>
<span class="cstat-no" title="statement not covered" >        while (offset &lt; until) {</span>
<span class="cstat-no" title="statement not covered" >            decodeFieldValue();</span>
<span class="cstat-no" title="statement not covered" >            vals.push(val);</span>
        }
<span class="cstat-no" title="statement not covered" >        val = vals;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    while (offset &lt; size) {</span>
<span class="cstat-no" title="statement not covered" >        len = slice.readUInt8(offset); <span class="cstat-no" title="statement not covered" ></span>offset++;</span>
<span class="cstat-no" title="statement not covered" >        key = slice.toString('utf8', offset, offset + len);</span>
<span class="cstat-no" title="statement not covered" >        offset += len;</span>
<span class="cstat-no" title="statement not covered" >        decodeFieldValue();</span>
<span class="cstat-no" title="statement not covered" >        fields[key] = val;</span>
    }
<span class="cstat-no" title="statement not covered" >    return fields;</span>
}
&nbsp;
module.exports.encodeTable = encodeTable;
module.exports.decodeFields = decodeFields;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Tue Apr 11 2017 13:43:38 GMT+0000 (UTC)</div>
</div>
</body>
</html>
